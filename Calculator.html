<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calculator</title>
</head>
<body>
<a href="index.html">HOME</a><br>
<input type="text" name="" id="trash" value="5+10+50%+9"><br>
<button onclick="calculate()">CALCULATE</button>

<script>

    //_________________________________________________прогнати спочатку одну дію, вдруг там два ділення
 //____________________________________________________з дужками  - розпарсити дужки в масив,вирізати масив по дужках, якщо є,
 // ___________________________________________________прогнати через рекурсію і вставити цифру
 // ___________________________________________________в остаток першого масиву, а далі знову в рекурсію
    //_________________________________________________split() divide string to array with letters
    //_________________________________________________percents takes from sum of all elements to the left/ we have to find% and set to the function all what are to the left

    function calculate() {

        let str = document.body.querySelector('#trash');
        let val = str.value;
        let arr = [];
        let i = 0;

        //string to array
        do {
            console.log('________' + i, val);
            let num = parseInt(val);
            arr[i] = num;
            i++;
            let numLeng = num.toString().length;
            val = val.slice(numLeng);

            if (val[0] === '%') {
                arr[i] = val[0];
                i++;
                val = val.slice(1);
            }
            console.log(i, val[0]);

            if (val.length > 0) {
                arr[i] = val[0]
                i++;
                val = val.slice(1);
            }
            console.log('\nval = ' + val + typeof val + val.length + '\nnum=' + num + typeof num + '\nnumLeng = ' + numLeng + '\ni = ' + i + '\narr = ' + arr);
    }while (val) ;

    //if brackets exist
    if (arr.indexOf("(")>-1){
        if (arr.indexOf("%")>-1 && arr.indexOf("%")>4){
           getPercents(arr);// ????????????????????????????????????????????????????????
        }
    }


        //count % if exist
    if (arr.indexOf("%")>-1 && arr.indexOf("%")>4){
        getPercents(arr);
    }


    let counter = operate(arr,arr.length)

    alert('Result = ' + counter.toFixed(2));
    }


    //percents counting
    function getPercents(arr){
        let statementWithPercent = arr.splice(0,arr.indexOf("%")+1);
        statementWithPercent.pop();
        let percentIndicator = statementWithPercent.splice(-1,1);
        statementWithPercent.pop();
        let beforePercentTake = operate(statementWithPercent, statementWithPercent.length);
        let result = beforePercentTake + ((beforePercentTake*percentIndicator)/100)
        arr.unshift(result);
        //console.log('@@@@'+arr, 'stat'+statementWithPercent, 'indicator' + percentIndicator, 'before'+beforePercentTake, 'result'+result);
    }


    //commit all operations according to execution queue
    function operate(arr, count) {

        if (count <= 0) {
            return arr[0];
        }
        // //percents second variant
        // let percent = 0;
        // while (arr.indexOf("%")>-1) {
        //     percent = arr.indexOf("%");
        //     if (count === 2 && arr[1] === '%'){
        //
        //         return arr[0]/100;
        //     }
        //     console.log(arr);
        //
        //     let per = (arr[(+percent) - 3] / 100) * arr[(+percent) - 1];
        //     arr[(+percent) - 1] = per;
        //     console.log(arr);
        //
        //     arr.splice(percent, 1);
        //     console.log(per, arr);
        // }

        // percents first variant
        // let percent = arr.indexOf("%");
        // if (percent > -1) {
        //
        //     if (count === 2 && arr[1] === '%'){
        //
        //         return arr[0]/100;
        //     }
        //     console.log(arr);
        //
        //     let per = (arr[(+percent) - 3] / 100) * arr[(+percent) - 1];
        //     arr[(+percent) - 1] = per;
        //     console.log(arr);
        //
        //     arr.splice(percent, 1);
        //     console.log(per, arr);
        // }



        let division = 0;
        while (arr.indexOf("/") > -1) {
            division = arr.indexOf("/");
            let div = arr[(+division) - 1] / arr[(+division) + 1];
            arr[(+division) - 1] = div;
            arr.splice(division, 2);
            console.log(div, arr);
        }

        let multiplication = 0;
        while(arr.indexOf("*") > -1) {
            multiplication = arr.indexOf("*");
            let mult = arr[(+multiplication) - 1] * arr[(+multiplication) + 1];
            arr[(+multiplication) - 1] = mult;
            arr.splice(multiplication, 2);
            console.log(mult, arr);
        }

        let minus = 0;
        while (arr.indexOf("-") > -1) {
            minus = arr.indexOf("-");
            let min = arr[(+minus) - 1] - arr[(+minus) + 1];
            arr[(+minus) - 1] = min;
            arr.splice(minus, 2);
            console.log(min, arr);
        }

        let plus = arr.indexOf("+");
        if (plus > -1) {
            let pl = arr[(+plus) - 1] + arr[(+plus) + 1];
            arr[(+plus) - 1] = pl;
            arr.splice(plus, 2);
            console.log(pl, arr);
        }

        return operate(arr, arr.length - 2);
    }
</script>

</body>
</html>